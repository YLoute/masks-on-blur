# masks-on-blur
Coded in python with a Graphical User Interface (GUI)
Created to generate masks on blurred areas with Laplacian Pyramid method on blurred areas for close-range Structure from Motion (SfM).
The GUI was made to be able to choose between parameters before running detection on a whole folder.

Bonus: refine detection of AprilTags centers (36h11, checkerboard pattern at the center) and write it in csv files

## Disclamer
This program is a test program, although it works correctly for generating masks on blurred areas using Laplacian Pyramid method. 

As a result, the Python code is quite messy and full of annotations and test functions.

## Needed external modules in python:
opencv-python (cv2),
robotpy_apriltag,
PySide6

exif,
imageio,
csv,
pywin32

plyer,
os,
pathlib,
time,
math,
numpy

## Steps for masks computing
1. Put the photographs concerned by the same parameters for mask generation in the same folder. JPG file format is mandatory.
2. After the external modules installed as mentionned above, run MAIN_GUI.py
3. Please note there are some useful tips at the bottom when your mouse goes over some buttons.
4. First menu line is dedicated for masks computing. It works from left to right:
5. Choose your folder;
6. Scroll to the photograph of your choice if needed;
7. Clean the exif rotation tag ! If the button is red-texted, you should press it after saving your original files elsewhere, as this is irrevocable.
8. Play with parameters on the right and click SHOW button to see the result. You can scroll to other photographs, it will keep those parameters.
   N.B. Few seconds are needed depending on your computer and the size of the JPG.
9. Third menu line : "Generate masks on entire folder" will compute masks in a subfolder, with its name summing up the chosen parameters from the first menu line.

## Steps for AprilTags 36h11 with checkerboard at the center detection and refine center detection
It's coded to refine center detection of this specific type. As long as you don't use such tags, you can avoid it.
Second menu line is dedicated for AprilTags 36h11 with checkerboard at the center. Third menu line first parameter is associated with second line. 

Choose the parameters, modify them at will and click "Detect AprilTags" to assess the quality of the detection.
Second line last buttons "<" and ">" allows to switch from a detected marker to another on 1:1 scale view.

If you intend to use your detected tags on RealityCapture, you can directly use tags' csv generated by "Gene tags on entire folder". 

If you want to import tags 2D-coordinates on Metashape, check the file: create_tags_on_metashape_EXEC_IN_METASHAPE.py. How-to-use is written at the beginning.

## Miscellaneous
Buttons save/load parameters are not currently working (TODO list). "Gene Sobel [...]" is a test function
12. ([...] Sobel is a test function)
